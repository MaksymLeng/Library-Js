(()=>{var l={},h=localStorage.getItem("lang")||"ru";async function p(t){l=await(await fetch(`lang/${t}.json`)).json(),h=t,localStorage.setItem("lang",t),I()}p(h);function I(){document.querySelectorAll("[data-i18n]").forEach(t=>{let e=t.getAttribute("data-i18n");l[e]&&(t.innerText=l[e])}),["title","author","genre","addBtn"].forEach(t=>{let e=document.getElementById(t);!e||!l[t]||(e.tagName==="INPUT"?e.placeholder=l[t]:e.tagName==="BUTTON"&&(e.innerText=l[t]))}),document.querySelectorAll("select option").forEach(t=>{let e=t.value;l[e]&&(t.textContent=l[e])})}function b(t){let e=document.getElementById("btn_navbook"),o=document.querySelector("#btn_navbook img");e.addEventListener("click",n=>{n.stopPropagation(),o.classList.toggle("rotated"),t.setMode(t.config.mode==="circular"?"random":"circular")})}function k(){let t=document.getElementById("btn_lang"),e=document.getElementById("lang_list");function o(n){let s=[...e.querySelectorAll("li")];n?e.style.display="block":setTimeout(()=>{e.style.display="none"},s.length*50+200),s.forEach((a,i)=>{setTimeout(()=>{a.classList.toggle("visible",n)},i*50)})}t.addEventListener("click",n=>{n.stopPropagation(),e.style.display==="block"?o(!1):o(!0),t.classList.toggle("active"),e.querySelectorAll("li").forEach(s=>{s.addEventListener("click",()=>{let a=s.dataset.lang;p(a),o(!1)})})})}function L(){let t=document.querySelector(".green-btn"),e=document.querySelector(".yellow-btn"),o=document.querySelector("#fileInput");e.addEventListener("mouseenter",()=>{t.classList.add("hovered")}),e.addEventListener("mouseleave",()=>{t.classList.remove("hovered")}),e.addEventListener("click",()=>{o.click()})}var S=function(){let t="lmgLibraryDB",e="books",o;function n(){return new Promise((i,r)=>{let c=indexedDB.open(t,1);c.onerror=()=>r("\u041E\u0448\u0438\u0431\u043A\u0430 IndexedDB"),c.onsuccess=()=>{o=c.result,i()},c.onupgradeneeded=d=>{d.target.result.createObjectStore(e,{keyPath:"name"})}})}async function s(i){return o||await n(),new Promise((r,c)=>{let m=o.transaction(e,"readwrite").objectStore(e),u={name:i.name,type:i.type,data:i},v=m.put(u);v.onsuccess=()=>r(),v.onerror=()=>c("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438 \u043A\u043D\u0438\u0433\u0438")})}async function a(i){return o||await n(),new Promise((r,c)=>{let u=o.transaction(e,"readonly").objectStore(e).get(i);u.onsuccess=()=>r(u.result?.data||null),u.onerror=()=>c("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u043A\u043D\u0438\u0433\u0438")})}return{saveBook:s,getBook:a}}(),g=S;function f(t,e){let o=document.getElementById("toast");o&&(o.textContent=t,o.classList.remove(e?"show-success":"show-warning"),setTimeout(()=>{o.classList.add(e?"show-success":"show-warning")},10),setTimeout(()=>{o.classList.remove(e?"show-success":"show-warning")},3e3))}function x(t){let e=document.getElementById("book-form"),o=document.querySelector("#fileInput"),n=null,s=new Set;o.addEventListener("change",()=>{n=o.files.length>0?o.files[0]:null}),e.addEventListener("submit",async a=>{if(a.preventDefault(),!n){f(l.toast_no_file,!1),console.log("Hello");return}if(s.has(n.name)){f(l.toast_duplicate_file,!1);return}let i=document.getElementById("title").value.trim(),r=document.getElementById("author").value.trim(),c=document.getElementById("genre").value.trim(),d=document.getElementById("status").value.trim();if(!i||!r)return;await g.saveBook(n);let m={title:i,author:r,genre:c,status:d,fileName:n.name};t.addBook(m),localStorage.setItem("books",JSON.stringify([])),s.add(n.name),e.reset(),o.value="",n=null,f(l.toast_success,!0)})}var E=class{constructor(t,e=[],o={}){this.container=document.getElementById(t),this.books=e,this.config={radius:o.radius||150,speed:o.speed||.01,mode:o.mode||"circular",maxFps:o.maxFps||60,randomSpeedRange:o.randomSpeedRange||[.5,2]},this.parentAngle=0,this.isPaused=!1,this.circlesData=[],this.lastFrameTime=0,this.config.mode==="random"&&this.container.classList.add("random-mode"),this.init()}init(){this.books.forEach(t=>this.addBookCircle(t)),this.animate()}addBook(t){this.books.push(t),this.addBookCircle(t)}addBookCircle(t){let e=document.createElement("div");e.classList.add("book-circle",t.status);let o=t.status==="read"?"\u2705":t.status==="reading"?"\u{1F4D6}":"\u{1F4CC}";e.innerHTML=`
            <div class="book-content">
                <span class="book-icon">${o}</span>
                <span class="book-title">${t.title[0].toUpperCase()}</span>
                <div class="book-details">
                    <p>Autor: ${t.author}</p>
                    <p>Title: ${t.title}</p>
                    <p>Genre: ${t.genre||"_"}</p>
                </div>
            </div>
        `;let n;e.addEventListener("click",()=>{clearTimeout(n),e.classList.contains("expanded")?n=setTimeout(()=>{if(t.fileName){let s=new CustomEvent("book-open-requested",{detail:{fileName:t.fileName,book:t}});window.dispatchEvent(s)}},300):(e.classList.add("expanded"),this.isPaused=!0)}),e.addEventListener("dblclick",s=>{s.stopPropagation(),clearTimeout(n),e.classList.remove("expanded"),this.isPaused=!1}),document.addEventListener("click",s=>{!s.target.closest(".book-circle")&&!document.getElementById("readerModal")&&(this.isPaused=!1,e.classList.remove("expanded"),this.container.querySelectorAll(".book-circle.expanded").forEach(a=>{a.classList.remove("expanded")}))}),this.container.appendChild(e),this.config.mode==="random"&&this.initRandomData(),this.updatePositions()}updatePositions(){this.config.mode==="circular"?this.updateCircularPosition():this.updateRandomPosition()}setMode(t){this.config.mode=t,t==="random"?(this.container.classList.add("random-mode"),this.initRandomData()):this.container.classList.remove("random-mode"),this.updatePositions()}updateCircularPosition(){let t=this.container.querySelectorAll(".book-circle"),e=t.length,o=this.config.radius;t.forEach((n,s)=>{let a=2*Math.PI/e*s+this.parentAngle,i=200,r=200,c=i+o*Math.cos(a),d=r+o*Math.sin(a);n.style.left=`${n.offsetLeft+(c-n.offsetLeft)*.1}px`,n.style.top=`${n.offsetTop+(d-n.offsetTop)*.1}px`,this.updateBookContent(n,a)})}updateBookContent(t,e){let o=t.querySelector(".book-content"),n=e*180/Math.PI;t.classList.contains("expanded")?o.style.transform="rotate(0deg)":this.isPaused||(o.style.transform=`rotate(${-n+180}deg)`)}initRandomData(){this.circlesData=[];let t=this.container.getBoundingClientRect();this.container.querySelectorAll(".book-circle").forEach(e=>{let o=Math.random()*t.width,n=Math.random()*t.height,[s,a]=this.config.randomSpeedRange,i=(Math.random()*(a-s)+s)*(Math.random()<.5?-1:1),r=(Math.random()*(a-s)+s)*(Math.random()<.5?-1:1);this.circlesData.push({element:e,x:o,y:n,vx:i,vy:r,angle:Math.random()*360,rotationRate:(Math.random()-.7)*.7}),e.style.left=`${o}px`,e.style.top=`${n}px`})}updateRandomPosition(){let t=this.container.getBoundingClientRect();this.circlesData.forEach(e=>{this.isPaused||(e.x+=e.vx,e.y+=e.vy,e.x<0&&(e.x=0,e.vx*=-1),e.x>t.width&&(e.x=t.width,e.vx*=-1),e.y<0&&(e.y=0,e.vy*=-1),e.y>t.height&&(e.y=t.height,e.vy*=-1)),e.element.style.left=`${e.x}px`,e.element.style.top=`${e.y}px`,e.angle+=e.rotationRate,this.updateBookContent(e.element,e.angle*Math.PI/180)})}animate(t){if(t-this.lastFrameTime<1e3/this.config.maxFps){requestAnimationFrame(this.animate.bind(this));return}this.lastFrameTime=t,this.config.mode==="circular"&&!this.isPaused&&(this.parentAngle+=this.config.speed),this.updatePositions(),requestAnimationFrame(this.animate.bind(this))}};var P=JSON.parse(localStorage.getItem("books"))||[],y=new E("bookCircles",P,{mode:"circular",radius:300,speed:.01});async function B(t,e){let o=document.getElementById("readerModal");if(!o){o=document.createElement("div"),o.id="readerModal";let n=document.createElement("div");if(n.id="readerViewer",o.appendChild(n),e.fileName&&e.fileName.endsWith(".epub")){n.innerHTML="";let a=ePub(t),i=a.renderTo("readerViewer",{width:"80%",height:"80%"});a.ready.then(()=>{i.display()}).catch(r=>{console.error("\u274C \u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u0438 \u043A\u043D\u0438\u0433\u0438:",r)})}else if(e.fileName.endsWith(".pdf")){let a=document.createElement("iframe");a.src=t,a.style.width="80vw",a.style.height="80vh",a.style.border="none",n.appendChild(a)}else n.innerHTML="<p style = 'color: white'> \u041D\u0435\u043F\u043E\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043C\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u0444\u0430\u0439\u043B\u0430</p>";let s=document.createElement("button");s.textContent="\xD7",s.classList.add("close-btn"),s.addEventListener("click",()=>{document.body.removeChild(o),URL.revokeObjectURL(t)}),o.appendChild(s),document.body.appendChild(o)}}function w(t){document.addEventListener("click",e=>{let o=document.getElementById("lang_list"),n=document.getElementById("btn_lang"),s=document.getElementById("menuPopup"),a=document.querySelector("#btn_navbook img");document.getElementById("readerModal")||(o.style.display="none",n.classList.remove("active"),s.style.display="none",a.classList.remove("rotated"),e.target.closest(".book-circle")||setTimeout(()=>{t.isPaused=!1,t.container.querySelectorAll(".book-circle.expanded").forEach(i=>i.classList.remove("expanded"))},0))}),window.addEventListener("book-open-requested",async e=>{let{fileName:o,book:n}=e.detail,s=await g.getBook(o);if(!s){alert("\u0424\u0430\u0439\u043B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D");return}let a=URL.createObjectURL(s);B(a,n)})}document.addEventListener("DOMContentLoaded",()=>{p(h),b(y),k(),L(),x(y),w(y)});})();
//# sourceMappingURL=bundle.js.map
